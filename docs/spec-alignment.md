# Spec Alignment Report

This table maps TOON specification clauses to the SwiftTOON tests/fixtures that cover them. CI (via `Scripts/check-spec-alignment.swift`) ensures every clause listed in `reference/spec/tests/fixtures/manifest.json` has a corresponding row.

| Clause | Description | Tests | Fixture | Reference SHA |
| --- | --- | --- | --- | --- |
| 2.2 – Blank-line separators | Blank lines may span between sections without altering object boundaries. | `Tests/TOONCoreTests/ParserTests.swift` (blank-line fixtures) | `reference/spec/tests/fixtures/decode/blank-lines.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 2.3 – Whitespace management | Insignificant whitespace is ignored so indentation-defined structure remains intact. | `Tests/TOONCoreTests/ParserTests.swift` (whitespace suites) | `reference/spec/tests/fixtures/decode/whitespace.toon` & `reference/spec/tests/fixtures/encode/whitespace.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 3.1.2 – Indentation-based objects | Objects are delimited by indentation rather than braces; keys align on the same indentation level. | `Tests/TOONCoreTests/ParserTests.swift` (indentation stack scenarios) | `reference/spec/tests/fixtures/objects/objects-simple.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 3.2 – Indentation validation | Improper dedents, irregular indent widths, and stray markers yield deterministic `TOONError`s. | `Tests/TOONCoreTests/ParserErrorDescriptionTests.swift` | `reference/spec/tests/fixtures/decode/indentation-errors.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 3.4 – Path expansion | Objects may declare nested paths (`a.b.c:`) that the parser unfolds while keeping offsets sane. | `Tests/ConformanceTests/RandomDifferentialTests.swift` | `reference/spec/tests/fixtures/decode/path-expansion.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 3.5 – Root-form scalars | Standalone scalars or single arrays remain valid as `root-form` fixtures establish. | `Tests/ConformanceTests/RandomDifferentialTests.swift` | `reference/spec/tests/fixtures/decode/root-form.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 4.1 – Primitive arrays | Arrays of primitives use `[N]` lengths or delimiter cues to guide analyzer decisions. | `Tests/ConformanceTests/EncodeFixtureTests.swift`, `Tests/ConformanceTests/RandomDifferentialTests.swift` | `reference/spec/tests/fixtures/encode/arrays-primitive.toon` & `reference/spec/tests/fixtures/decode/arrays-primitive.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 4.2 – Tabular arrays | Uniform arrays declare headers once and encode rows as comma-separated values. | `Tests/TOONCodableTests/ToonArrayAnalyzerTests.swift`, `Tests/ConformanceTests/EncodeFixtureTests.swift` | `reference/spec/tests/fixtures/arrays-tabular/toon/canonical.toon` & `reference/spec/tests/fixtures/decode/arrays-tabular.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 4.3 – List arrays | Dash-delimited list arrays allow sparse/heterogeneous rows with optional `[N]:` hints. | `Tests/ConformanceTests/EncodeFixtureTests+ArrayChecks.swift`, `Tests/ConformanceTests/RandomDifferentialTests.swift` | `reference/spec/tests/fixtures/decode/arrays-nested.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 4.4 – Nested arrays | Nested tabular/list combinations rely on `arrays-nested` structures and length anchors. | `Tests/ConformanceTests/RandomDifferentialTests.swift` | `reference/spec/tests/fixtures/encode/arrays-nested.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 4.5 – Arrays of objects | Arrays containing objects use header rows plus metadata to maintain field order. | `Tests/ConformanceTests/EncodeFixtureTests.swift` | `reference/spec/tests/fixtures/encode/arrays-objects.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 5.1 – Key quoting & escaping | Keys containing whitespace or special chars require quoting/backslash escapes. | `Tests/TOONCoreTests/ParserTests.swift` (quoted key suites) | `reference/spec/tests/fixtures/objects/objects-quoting.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 5.2 – Scalar quoting | Strings with delimiters, commas, or colon-like characters rely on quotes and escapes. | `Tests/TOONCodableTests/ToonSerializerTests.swift` (quoter matrix) | `reference/spec/tests/fixtures/primitives/primitives-strings.toon` & `reference/spec/tests/fixtures/encode/primitives.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 5.3 – Numbers & precision | Numeric literals preserve precision and reject invalid formats via the parser’s state machine. | `Tests/TOONCoreTests/JSONTextParserTests.swift`, `Tests/TOONCodableTests/DecoderFixtureTests.swift` | `reference/spec/tests/fixtures/primitives/primitives-numbers.toon` & `reference/spec/tests/fixtures/decode/numbers.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 6.1 – Strict validation | Strict mode rejects missing fields, duplicate keys, and unexpected indent changes. | `Tests/TOONCoreTests/ParserErrorDescriptionTests.swift`, `Tests/TOONCodableTests/DecoderFixtureTests.swift` | `reference/spec/tests/fixtures/decode/validation-errors.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 7.1 – Delimiter tokens | Comma/tab/pipe tokens control row parsing; lenient mode recovers from missing markers. | `Tests/ConformanceTests/EncodeFixtureTests.swift`, `Tests/TOONCodableTests/DecoderFixtureTests.swift` | `reference/spec/tests/fixtures/decode/delimiters.toon` & `reference/spec/tests/fixtures/encode/delimiters.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 7.2 – Key folding | Dotted keys flatten once analyzer asserts uniqueness, preventing collisions. | `Tests/TOONCodableTests/ToonSerializerTests.swift`, `Tests/ConformanceTests/EncodeFixtureTests+ArrayChecks.swift` | `reference/spec/tests/fixtures/encode/key-folding.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 7.5 – TOON Metadata | Length prefixes (`[N]`) and delimiter markers produce predictable analyzer offsets. | `Tests/TOONCodableTests/ToonArrayAnalyzerTests.swift`, `Tests/ConformanceTests/EncodeFixtureTests.swift` | `reference/spec/tests/fixtures/objects/objects-metadata.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |
| 8.2 – Lenient CLI stats | The `toon-swift stats` command reports bytes/token savings plus delimiter heuristics. | `Tests/ConformanceTests/ReferenceHarnessTests.swift` (stats snapshot) | `reference/spec/tests/fixtures/stats/stats-simple.toon` | `1eb34e29f419e446edce4ff1835d0e141bcaa015` |

## Maintenance

- Keep this file in sync with `reference/spec/tests/fixtures/manifest.json`; ideally every `manifest` entry has a matching clause row.
- When the spec version changes, update the Reference SHA column and the header above.
